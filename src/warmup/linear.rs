use std::io;

/*ВСПОМОГАТЕЛЬНЫЕ МОДУЛИ */
/*ВСПОМОГАТЕЛЬНЫЕ МОДУЛИ */

/// Читает число с плавающей точкой из стандартного ввода
///
/// # Аргументы
/// * `prompt` - строка с приглашением для ввода
///
/// # Возвращаемое значение
/// * `f64` - введенное пользователем число
///
/// # Пример
/// ```
/// let number = read_f64("Введите число:");
/// ```

fn read_f64(prompt: &str) -> f64 {
    loop {
        println!("{}", prompt);
        let mut input = String::new();
        io::stdin()
            .read_line(&mut input)
            .expect("Ошибка чтения ввода");

        match input.trim().parse() {
            Ok(num) => return num,
            Err(_) => println!("Ошибка! Введите число."),
        }
    }
}

/// Читает целое положительное число из стандартного ввода
///
/// # Аргументы
/// * `prompt` - строка с приглашением для ввода
///
/// # Возвращаемое значение
/// * `u32` - введенное пользователем целое положительное число
///
/// # Пример
/// ```
/// let number = read_u32("Введите количество:");
/// ```

fn read_u32(prompt: &str) -> u32 {
    loop {
        println!("{}", prompt);
        let mut input = String::new();
        io::stdin()
            .read_line(&mut input)
            .expect("Ошибка чтения ввода");
        match input.trim().parse() {
            Ok(num) => return num,
            Err(_) => println!("Ошибка! Введите целое положительное число."),
        }
    }
}

/* ============================================================================
====================                                       ====================
====================             TASKS                     ====================
====================                                       ====================
 ==============================================================================*/


 /// Задача 1: Арифметическая прогрессия
///
/// Известны первый и пятый члены арифметической прогрессии.
/// Найти величину члена прогрессии с номером N и сумму членов.
///
/// # Формулы
/// * Разность прогрессии: d = (a₅ - a₁) / 4
/// * N-ный член: aₙ = a₁ + (n-1) * d
/// * Сумма n членов: Sₙ = (2*a₁ + (n-1)*d) * n / 2

pub fn task1() {
    println!("Задача 1: Арифметичекская прогрессия");
    println!("Известны первый и пятый члены прогрессии");
    println!("Найти величину члена прогрессии с номером N и сумму членов");

    let a1 = read_f64("Введите первый член прогрессии (a1):");
    let a5 = read_f64("Введите пятый член прогрессии (a5):");
    let n = read_u32("Введите номер N:");

    let d = (a5 - a1) / 4.0;
    let an_value = a1 + (n as f64 - 1.0) * d;
    let sn = (2.0 * a1 + (n as f64 - 1.0) * d) * n as f64 / 2.0;

    println!("Результат:");
    println!("  Разность прогрессии d = {:.4}", d);
    println!("  Члены прогрессии a{} = {:.4}", n, an_value);
    println!("  Сумма первых {} членов S{} = {:.4}", n, n, sn);
}

/// Задача 2: Сумма членов арифметической прогрессии
///
/// Известны члены прогрессии с номерами N и M.
/// Найти сумму членов c номерами от M до N (M < N).
///
/// # Формулы
/// * Разность прогрессии: d = (aₙ - aₘ) / (n - m)
/// * Первый член: a₁ = aₙ - (n-1) * d
/// * Сумма от M до N: S = Sₙ - Sₘ₋₁

pub fn task2() {
    println!("Задача 2: Сумма членов арифметичекской прогрессии");
    println!("Известны члены прогрессии с номерами N и M");
    println!("Найти сумму членов c номерами от M до N (M < N)");

    let an = read_f64("Введите член N:");
    let am = read_f64("Введите член M:");
    let n = read_u32("Введите номер N:");
    let m = read_u32("Введите номер M:");

    let d = (an - am) / (n as f64 - m as f64);
    let a1 = an - (n as f64 - 1.0) * d;
    let sum_n = 2.0 * a1 + (n as f64 - 1.0) * d;
    let sum_m = 2.0 * a1 + (m as f64 - 1.0) * d;

    let sum_m_to_n = sum_n - sum_m + am;

    println!("Результат:");
    println!("  Разность прогрессии d = {:.4}", d);
    println!("  Первый член прогрессии a1 = {:.4}", a1);
    println!(
        "  Сумма членов от {} до {} (включительно)= {:.4}",
        m, n, sum_m_to_n
    );
    println!("  (Членов сумме: {})", n - m + 1);
}

/// Задача 3: Геометрическая прогрессия
///
/// Известны первый член и знаменатель прогрессии.
/// Найти сумму членов с номерами от К до Р (К < Р).
///
/// # Формулы
/// * K-ный член: bₖ = b₁ * q^(k-1)
/// * Сумма от K до P: S = bₖ * (1 - q^(p-k+1)) / (1 - q) при q ≠ 1

pub fn task3() {
    println!("Задача 3: Геометрическая прогрессия");
    println!("Известны первый член и знаменатель прогрессии");
    println!("Найти сумму членов с номерами от К до Р (К < Р)");

    let b1 = read_f64("Введите первый член прогрессии (b1):");
    let q = read_f64("Введите знаменатель прогрессии (q):");
    let k = read_u32("Введите начальный номер К:");
    let p = read_u32("Введите конечный номер Р:");

    if k >= p {
        println!("К не должно быть больше Р!");
        return;
    }

    if q == 0.0 {
        println!("Внимание: знаменатель равен 0!");
        println!("Все члены прогрессии кроме первого будут равны 0.");
    }

    let bk = b1 * q.powf(k as f64 - 1.0);
    let n_terms = p - k + 1;
    let sum_k_to_p = if q == 1.0 {
        bk * n_terms as f64
    } else {
        bk * (1.0 - q.powf(n_terms as f64)) / (1.0 - q)
    };

    println!("Результат:");
    println!("  Сумма членов от {} до {} = {:.6}", k, p, sum_k_to_p);
}

/// Задача 4: Перевод температуры
///
/// Перевод температуры из градусов Фаренгейта в градусы Цельсия.
/// Формула: °C = (5/9) * (°F - 32)
///
/// # Литературная ссылка
/// Название задачи отсылает к роману Рэя Брэдбери "451 градус по Фаренгейту".

pub fn task4() {
    println!("Задача 4: Перевод температуры");
    println!("Программа для перевода из Фаренгейтов в Цельсию");

    let tf = 451.0;
    let tc = (5.0 / 9.0) * (tf - 32.0);

    println!("    {} F = {:.1} C", tf, tc);
    println!("Название повести: '{:.1} градус по Цельсию'", tc);
}

/// Задача 5: Найти процент троек в классе
///
/// По количеству учеников, количеству пятерок и четверок
/// вычислить процент троек в классе.
///
/// # Формула
/// * Количество троек = N - A - B
/// * Процент троек = (троек / N) * 100%

pub fn task5() {
    println!("Задача 5: Найти процент троек в классе");

    let n = read_u32("Введите количество учеников (N):");
    let a = read_u32("Введите количество пятерок (А):");
    let b = read_u32("Введите количество четверок (В):");

    let threes = n - a - b;
    let solutions = (threes as f64 / n as f64) * 100.0;

    println!("Результат:");
    println!("  Количество троек: {}", threes);
    println!("  Процент троек: {:.1}%", solutions);
}

/// Задача 6: Вычислить выражение
///
/// Вычисление выражения: 100³ - 92² + k
/// где k - вводимое пользователем значение.

pub fn task6() {
    println!("Задача 6: Вычислить выражение");

    let k = read_f64("Введите значение (k):");

    let result = 100.0_f64.powi(3) - 92.0_f64.powi(2) + k;

    println!("Результат:");
    println!("  Выражение равняется: {}", result);
}

/// Задача 7: Вычислить тригонометрическое выражение
///
/// Вычисление выражения: √((1 - cos(x)) / 2)
/// что эквивалентно |sin(x/2)| по формуле половинного угла.

pub fn task7() {
    println!("Задача 7: Вычислить выражение");

    let x = read_f64("Введите значение (x):");
    let result = ((1.0 - x.cos()) / 2.0).sqrt();

    println!("Результат:");
    println!("  Выражение равняется: {:.6}", result);
}

/// Задача 8: Вычисление медианы треугольника
///
/// По трем сторонам треугольника a, b, c
/// вычислить медиану, проведенную к стороне a.
///
/// # Формула
/// * Медиана к стороне a: mₐ = ½√(2b² + 2c² - a²)

pub fn task8() {
    println!("Задача 8: Вычисление медианы треугольника");
    println!("Заданы стороны треугольника a, b, c");
    println!("Вычислить медиану к стороне а");

    let a = read_f64("Введите значение а:");
    let b = read_f64("Введите значение b:");
    let c = read_f64("Введите значение c:");

    let p = (a + b + c) / 2.0;

    let median = (1.0 / 2.0) * (2.0 * b.powi(2) * 2.0 * c.powi(2) - a.powi(2)).sqrt();

    println!("Результат:");
    println!("  Значение p: {}", p);
    println!("  Медиана к стороне a равняется: {:.1}", median);
}

/// Задача 9: Вычисление биссектрисы угла треугольника
///
/// По трем сторонам треугольника a, b, c
/// вычислить биссектрису угла A.
///
/// # Формула
/// * Биссектриса угла A: lₐ = (2√(bcp(p-a))) / (b+c)
/// где p - полупериметр

pub fn task9() {
    println!("Задача 9: Вычисление биссектриссы угла треугольника");
    println!("Заданы стороны треугольника a, b, c");
    println!("Вычислить биссектриссу угла А");

    let a = read_f64("Введите значение а:");
    let b = read_f64("Введите значение b:");
    let c = read_f64("Введите значение c:");

    let p = (a + b + c) / 2.0;

    let angle_bisector = (2.0 * (b * c * p * (p - a)).sqrt()) / (b + c);

    println!("Результат:");
    println!("  Значение p: {}", p);
    println!("  Биссектрисса угла А равняется: {:.1}", angle_bisector);
}

pub fn task10() {
    println!("Задача 10: Вычисление высоты треугольника");
    println!("Заданы стороны треугольника a, b, c");
    println!("Вычислить медиану к стороне а");

    let a = read_f64("Введите значение а:");
    let b = read_f64("Введите значение b:");
    let c = read_f64("Введите значение c:");

    let p = (a + b + c) / 2.0;

    let height = (2.0 / a) * (p * (p - a) * (p - b) * (p - c)).sqrt();

    println!("Результат:");
    println!("  Значение p: {}", p);
    println!("  Высота к стороне a равняется: {:.1}", height);
}
