use std::f64::consts::PI;
use std::io;

/* ВСПОМОГАТЕЛЬНЫЕ МОДУЛИ */

/// Читает число с плавающей точкой из стандартного ввода
///
/// # Аргументы
/// * `prompt` - строка с приглашением для ввода
///
/// # Возвращаемое значение
/// * `f64` - введенное пользователем число

fn read_f64(prompt: &str) -> f64 {
    loop {
        println!("{}", prompt);
        let mut input = String::new();
        io::stdin()
            .read_line(&mut input)
            .expect("Ошибка чтения ввода");

        match input.trim().parse() {
            Ok(num) => return num,
            Err(_) => println!("Ошибка! Введите число."),
        }
    }
}

/// Читает целое положительное число из стандартного ввода
///
/// # Аргументы
/// * `prompt` - строка с приглашением для ввода
///
/// # Возвращаемое значение
/// * `u32` - введенное пользователем целое положительное число

fn read_u32(prompt: &str) -> u32 {
    loop {
        println!("{}", prompt);
        let mut input = String::new();
        io::stdin()
            .read_line(&mut input)
            .expect("Ошибка чтения ввода");
        match input.trim().parse() {
            Ok(num) => return num,
            Err(_) => println!("Ошибка! Введите целое положительное число."),
        }
    }
}

/// Читает целое число (отрицательное или положительное) из стандартного ввода
///
/// # Аргументы
/// * `prompt` - строка с приглашением для ввода
///
/// # Возвращаемое значение
/// * `i32` - введенное пользователем целое число

fn read_i32(prompt: &str) -> i32 {
    loop {
        println!("{}", prompt);
        let mut input = String::new();
        io::stdin()
            .read_line(&mut input)
            .expect("Ошибка чтения ввода");
        match input.trim().parse() {
            Ok(num) => return num,
            Err(_) => println!("Ошибка! Введите целое число."),
        }
    }
}

/// Задача 1: Проверка кратности числа трем
///
/// Для заданного целого числа N выяснить, кратно ли оно трем.
/// Выводит результат проверки и остаток от деления (если есть).

pub fn task1() {
    println!("Задача 1: Кратность числа");
    println!("ЦДля заданного целого числа N выяснить, кратно ли оно трем");

    let n = read_u32("Введите целое число (N):");

    if n % 3 == 0 {
        println!("Число {} кратно трем", n);
        println!("{} / 3 = {}", n, n / 3);
    } else {
        println!("Число {} не кратен трем", n);
        println!("Остаток от деления на 3: {}", n % 3);
    }
}

/// Задача 2: Вычисление значения z по формуле
///
/// z = (min(x, y) + 0.5) / (1 + max²(x, y))
/// где min(x, y) - минимальное из двух чисел,
/// max(x, y) - максимальное из двух чисел.

pub fn task2() {
    println!("Задача 2: Вычисление значения z");
    println!("z = (min(x, y) + 0.5) / (1 + max²(x, y))");

    let x = read_f64("Введите x:");
    let y = read_f64("Введите y:");

    let min_val = if x < y { x } else { y };
    let max_val = if x > y { x } else { y };

    let z = (min_val + 0.5) / (1.0 + max_val * max_val);

    println!("min({}, {}) = {}", x, y, min_val);
    println!("max({}, {}) = {}", x, y, max_val);
    println!(
        "z = ({:.4} + 0.5) / (1 + {:.4}²) = {:.4}",
        min_val, max_val, z
    );
}

/// Задача 3: Вычисление значения z по условию
///
/// * z = max(x, y) при x < 0
/// * z = min(x, y) при x >= 0

pub fn task3() {
    println!("Задача 3: Вычисление значения z");
    println!("z = max(x, y) при x < 0");
    println!("z = min(x, y) при x >= 0");

    let x = read_f64("Введите x:");
    let y = read_f64("Введите y:");

    let z = if x < 0.0 {
        if x > y { x } else { y }
    } else {
        if x < y { x } else { y }
    };

    println!("x = {}, y = {}", x, y);
    println!("Условие: x {} 0", if x < 0.0 { "<" } else { ">=" });
    println!("z = {:.4}", z);
}

/// Задача 4: Вычисление кусочно-заданной функции f(x)
///
/// Функция задана тремя выражениями:
/// * f(x) = 4, при x < 0
/// * f(x) = x² + 3x + 4, при 0 <= x < 1
/// * f(x) = x + 7, при x > 1
/// При x = 1 функция не определена.

pub fn task4() {
    println!("Задача 4: Вычисление функции f(x)");
    println!("f(x) = 4, при x < 0");
    println!("f(x) = x² + 3x + 4, при 0 <= x < 1");
    println!("f(x) = x + 7, при x > 1");
    println!("(при x = 1 функция не определена)");

    let x = read_f64("Введите x:");

    let result = if x < 0.0 {
        4.0
    } else if x < 1.0 {
        x * x + 3.0 * x + 4.0
    } else if x > 1.0 {
        x + 7.0
    } else {
        println!("Ошибка: функция не определена при x = 1");
        return;
    };

    println!("x = {:.4}", x);
    println!("f(x) = {:.4}", result);
}

/// Задача 5: Вычисление тригонометрической функции f(x)
///
/// Функция задана тремя выражениями с параметрами a и b:
/// * f(x) = sin²(x + π/2), при x < a
/// * f(x) = e^x * sin(x + π/2), при a <= x <= b
/// * f(x) = √(sin(x + π/3)) + 2.1 * 10⁻³, при x > b
/// Требование: a ≤ b

pub fn task5() {
    println!("Задача 5: Вычисление функции f(x)");
    println!("f(x) = sin²(x + π/2), при x < a");
    println!("f(x) = e^x * sin(x + π/2), при a <= x <= b");
    println!("f(x) = √(sin(x + π/3)) + 2.1 * 10⁻³, при x > b");

    let x = read_f64("Введите x:");
    let a = read_f64("Введите параметр a:");
    let b = read_f64("Введите параметр b:");

    if a > b {
        println!("Ошибка: a должно быть меньше или равно b");
        return;
    }

    let result = if x < a {
        let arg = x + PI / 2.0;
        arg.sin().powi(2)
    } else if x <= b {
        let arg = x + PI / 2.0;
        x.exp() * arg.sin()
    } else {
        let arg = x + PI / 3.0;
        arg.sin().sqrt() + 2.1e-3
    };

    println!("x = {:.4}, a = {:.4}, b = {:.4}", x, a, b);
    println!("f(x) = {:.8}", result);
}

/// Задача 6: Вычисление функции по графику (треугольный импульс)
///
/// Функция задана графически:
/// * f(x) = 1 - |x|, при -1 <= x <= 1
/// * f(x) = 0, при |x| > 1
/// График представляет собой равнобедренный треугольник.

pub fn task6() {
    println!("Задача 6: Вычисление функции f(x) по графику");
    println!("f(x) = 1 - |x|, при -1 <= x <= 1");
    println!("f(x) = 0, при |x| > 1");

    let a = read_f64("Введите число a:");

    let result = if a.abs() <= 1.0 { 1.0 - a.abs() } else { 0.0 };

    println!("a = {:.4}", a);
    println!("|a| = {:.4}", a.abs());
    println!("f(a) = {:.4}", result);
}

/// Задача 7: Определение координатной четверти
///
/// По координатам точки (x, y) определить,
/// в какой координатной четверти она находится.
/// Также обрабатываются особые случаи: оси координат и начало координат.

pub fn task7() {
    println!("Задача 7: Координатная четверть");
    println!("Определить, в какой координатной четверти находится точка (x, y)");

    let x = read_f64("Введите координату x:");
    let y = read_f64("Введите координату y:");

    println!("Точка: ({:.2}, {:.2})", x, y);

    if x > 0.0 && y > 0.0 {
        println!("I четверть (правая верхняя)");
    } else if x < 0.0 && y > 0.0 {
        println!("II четверть (левая верхняя)");
    } else if x < 0.0 && y < 0.0 {
        println!("III четверть (левая нижняя)");
    } else if x > 0.0 && y < 0.0 {
        println!("IV четверть (правая нижняя)");
    } else if x == 0.0 && y == 0.0 {
        println!("Начало координат");
    } else if x == 0.0 {
        println!("На оси Y");
    } else if y == 0.0 {
        println!("На оси X");
    }
}

/// Задача 8: Расстояние до контура полукруга
///
/// Определить расстояние от точки (x, y) до контура полукруга
/// с радиусом R и центром в (0, 0), расположенного в нижней полуплоскости.
///
/// # Алгоритм
/// 1. Если точка внутри полукруга: расстояние = |R - расстояние_до_центра|
/// 2. Если точка в верхней полуплоскости: минимальное расстояние до концов диаметра или до оси X
/// 3. Если точка в нижней полуплоскости вне круга: расстояние = расстояние_до_центра - R

pub fn task8() {
    println!("Задача 8: Расстояние до полукруга");
    println!("Определить расстояние от точки (x, y) до контура полукруга");
    println!("Полукруг: радиус R, центр в (0, 0), нижняя полуплоскость");

    let x = read_f64("Введите координату x:");
    let y = read_f64("Введите координату y:");
    let r = read_f64("Введите радиус R:");

    if r <= 0.0 {
        println!("Ошибка: радиус должен быть положительным!");
        return;
    }

    let distance_to_center = (x * x + y * y).sqrt();

    let distance = if y <= 0.0 && distance_to_center <= r {
        // Внутри или на границе полукруга
        (r - distance_to_center).abs()
    } else {
        // Вне полукругa
        if y > 0.0 {
            // В верхней полуплоскости
            let to_left_end = ((x + r).powi(2) + y.powi(2)).sqrt();
            let to_right_end = ((x - r).powi(2) + y.powi(2)).sqrt();
            y.min(to_left_end.min(to_right_end))
        } else {
            // В нижней полуплоскости, но вне круга
            distance_to_center - r
        }
    };

    println!("Точка: ({:.4}, {:.4})", x, y);
    println!("Радиус полукруга: {:.4}", r);
    println!("Расстояние до центра: {:.4}", distance_to_center);
    println!("Расстояние до контура полукруга: {:.4}", distance);
}

/// Задача 9: Проверка полуплоскости
///
/// Проверить, лежит ли точка (x, y) в верхней полуплоскости.
/// Учитываются все случаи: верхняя, нижняя полуплоскости и ось X.

pub fn task9() {
    println!("Задача 9: Проверка полуплоскости");
    println!("Проверить, лежит ли точка (x, y) в верхней полуплоскости");

    let x = read_f64("Введите координату x:");
    let y = read_f64("Введите координату y:");

    println!("Точка: ({:.2}, {:.2})", x, y);

    if y > 0.0 {
        println!("Точка лежит в ВЕРХНЕЙ полуплоскости (y > 0)");
    } else if y < 0.0 {
        println!("Точка лежит в НИЖНЕЙ полуплоскости (y < 0)");
    } else {
        println!("Точка лежит на ОСИ X (y = 0)");
    }
}

/// Задача 10: Проверка четности двух чисел
///
/// Определить, оба числа четные, оба нечетные,
/// или одно четное, а другое нечетное.

pub fn task10() {
    println!("Задача 10: Проверка четности двух чисел");
    println!("Определить, оба четные, оба нечетные, или одно четное, а другое нечетное");

    let a = read_i32("Введите первое целое число:");
    let b = read_i32("Введите второе целое число:");

    let a_even = a % 2 == 0;
    let b_even = b % 2 == 0;

    println!(
        "Первое число: {} ({}четное)",
        a,
        if a_even { "" } else { "не" }
    );
    println!(
        "Второе число: {} ({}четное)",
        b,
        if b_even { "" } else { "не" }
    );

    if a_even && b_even {
        println!("Оба числа четные");
    } else if !a_even && !b_even {
        println!("Оба числа нечетные");
    } else {
        println!("Одно число четное, другое нечетное");
    }
}
