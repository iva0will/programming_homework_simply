use std::io;

/* ВСПОМОГАТЕЛЬНЫЕ МОДУЛИ */
/// Читает целое положительное число из стандартного ввода
///
/// # Аргументы
/// * `prompt` - строка с приглашением для ввода
///
/// # Возвращаемое значение
/// * `u32` - введенное пользователем целое положительное число

fn read_u32(prompt: &str) -> u32 {
    loop {
        println!("{}", prompt);
        let mut input = String::new();
        io::stdin()
            .read_line(&mut input)
            .expect("Ошибка чтения ввода");
        match input.trim().parse() {
            Ok(num) => return num,
            Err(_) => println!("Ошибка! Введите целое положительное число."),
        }
    }
}

/// Задача 1: Количество цифр в числе
///
/// Дано натуральное число n. Определить, сколько цифр в этом числе.
/// Использует алгоритм последовательного деления на 10.
///
/// # Особый случай
/// * Для числа 0 возвращает 1 цифру

pub fn task1() {
    println!("Задача 1: Количество цифр в числе");
    println!("Дано натуральное число n. Сколько цифр в этом числе?");

    let n = read_u32("Введите натуральное число n:");

    if n == 0 {
        println!("Число: 0");
        println!("Количество цифр: 1");
    }

    let mut count = 0;
    let mut temp = n;

    while temp > 0 {
        count += 1;
        temp /= 10; //убираем последнюю цифру
    }

    println!("Результат:");
    println!("Число: {}", n);
    println!("Количество цифр: {}", count);
}

/// Задача 2: Сумма цифр числа
///
/// Дано натуральное число n. Найти сумму его цифр.
/// Алгоритм последовательно извлекает цифры и суммирует их.
///
/// # Пример
/// Для числа 123 сумма цифр = 1 + 2 + 3 = 6

pub fn task2() {
    println!("Задача 2: Сумма цифр числа");
    println!("Дано натуральное число n. Чему равна сумма его цифр?");

    let n = read_u32("Введите натуральное число n:");

    let mut sum = 0;
    let mut temp = n;
    let mut digits = Vec::new();

    if n == 0 {
        sum = 0;
        digits.push(0);
    } else {
        while temp > 0 {
            let digit = temp % 10;
            sum += digit;
            digits.push(digit);
            temp /= 10;
        }
        digits.reverse(); // сортировка от 0 до n
    }

    println!("Результат:");
    println!("Число: {}", n);
    println!("Цифры числа: {:?}", digits);
    println!("Сумма цифр: {}", sum);
}

/// Задача 3: Поиск цифры 3 в числе
///
/// Дано число n. Проверить, есть ли в нем цифра 3.
/// Выводит позиции (с конца), на которых найдена цифра 3.
///
/// # Алгоритм
/// Проверяет каждую цифру числа, начиная с младшего разряда.

pub fn task3() {
    println!("Задача 3: поиск цифры 3");
    println!("Дано число n. Есть ли в нем цифра 3?");

    let n = read_u32("Введите число n:");

    let mut contains_three = false;
    let mut temp = n;
    let mut positions = Vec::new();
    let mut position = 1;

    if n == 0 {
        println!("В числе 0 нет цифры 3");
        return;
    } else {
        while temp > 0 {
            let digit = temp % 10;
            if digit == 3 {
                contains_three = true;
                positions.push(position);
            }
            temp /= 10;
            position += 1;
        }
    }

    println!("Результат:");
    if contains_three {
        println!("Цифра 3 НАЙДЕНА");
        positions.reverse();
        println!("Цифра 3 находится на следующих позиция: {:?}", positions);
    } else {
        println!("Цифры 3 НЕ ОБНАРУЖЕНО");
    }
}

/// Задача 4: Перевернуть число
///
/// Дано число n. Поменять порядок цифр числа n на обратный.
/// Например: 123 → 321
///
/// # Алгоритм
/// Последовательно извлекает цифры и формирует новое число.

pub fn task4() {
    println!("Задача 4: Перевернуть число");
    println!("Дано число n. Поменять порядок цифр числа n на обратный");

    let n = read_u32("Введите число n:");

    let mut reversed = 0;
    let mut temp = n;

    if n == 0 {
        reversed = 0;
    }

    while temp > 0 {
        let digit = temp % 10;
        reversed = reversed * 10 + digit;
        temp /= 10;
    }

    println!("Результат:");
    println!("Исходное число: {}", n);
    println!("Обратное число: {}", reversed);
}

/// Задача 5: Перевернуть число (альтернативная реализация)
///
/// Дано натуральное число n. Поменять порядок цифр числа n на обратный.
/// Более подробная версия задачи 4.

pub fn task5() {
    println!("Задача 5: Перевернуть число");
    println!("Дано натуральное число n. Поменять порядок цифр числа n на обратный.");

    let n = read_u32("Введите натуральное число n:");

    let mut reversed = 0;
    let mut temp = n;

    while temp > 0 {
        let digit = temp % 10;
        reversed = reversed * 10 + digit;
        temp /= 10;
    }

    // Особый случай для 0
    if n == 0 {
        reversed = 0;
    }

    println!("Исходное число: {}", n);
    println!("Перевернутое число: {}", reversed);
}

/// Задача 6: Поменять первую и последнюю цифры
///
/// Дано натуральное число n. Переставить первую и последнюю цифры числа n.
/// Например: 12345 → 52341
///
/// # Алгоритм
/// 1. Определяет количество цифр
/// 2. Извлекает первую и последнюю цифры
/// 3. Формирует новое число
///
/// # Требования
/// * Число должно содержать хотя бы 2 цифры

pub fn task6() {
    println!("Задача 6: Поменять первую и последнюю цифры");
    println!("Дано натуральное число n. Переставить первую и последнюю цифры числа n.");

    let n = read_u32("Введите натуральное число n:");

    if n < 10 {
        println!("Число должно содержать хотя бы 2 цифры!");
        return;
    }

    // Находим количество цифр
    let mut count = 0;
    let mut temp = n;
    while temp > 0 {
        count += 1;
        temp /= 10;
    }

    // Находим первую и последнюю цифры
    let last_digit = n % 10;
    let first_digit = n / 10_u32.pow(count - 1);

    // Убираем первую и последнюю цифры
    let middle_part = (n % 10_u32.pow(count - 1)) / 10;

    // Собираем новое число
    let result = last_digit * 10_u32.pow(count - 1) + middle_part * 10 + first_digit;

    println!("Исходное число: {}", n);
    println!("Количество цифр: {}", count);
    println!("Первая цифра: {}", first_digit);
    println!("Последняя цифра: {}", last_digit);

    if count > 2 {
        println!(
            "Средняя часть (без первой и последней цифр): {}",
            middle_part
        );
    }

    println!("Результат (поменяли местами): {}", result);
}

/// Задача 7: Подсчет нулей в числе
///
/// Дано натуральное число n. Сколько раз цифра 0 входит в запись этого числа?
/// Например: 100203 → содержит 3 нуля
///
/// # Особый случай
/// * Число 0 содержит один ноль

pub fn task7() {
    println!("Задача 7: Подсчет нулей");
    println!("Дано натуральное число n. Сколько раз входит 0 в запись этого числа?");

    let n = read_u32("Введите натуральное число n:");

    let mut count_zeros = 0;
    let mut temp = n;

    if n == 0 {
        count_zeros = 1; // Ноль содержит один ноль
    } else {
        while temp > 0 {
            if temp % 10 == 0 {
                count_zeros += 1;
            }
            temp /= 10;
        }
    }

    println!("Число: {}", n);

    if count_zeros == 0 {
        println!("В числе нет цифр 0.");
    } else {
        println!("Количество нулей в числе: {}", count_zeros);
    }
}

/// Задача 8: Сравнение суммы квадратов цифр с самим числом
///
/// Дано натуральное число n. Проверить, будет ли сумма квадратов цифр,
/// составляющих это число, больше самого числа.
///
/// # Пример
/// Для числа 12: 1² + 2² = 1 + 4 = 5, 5 < 12

pub fn task8() {
    println!("Задача 8: Сравнение суммы квадратов цифр");
    println!("Дано натуральное число n. Проверить, будет ли сумма квадратов цифр,");
    println!("составляющих это число, больше самого числа.");

    let n = read_u32("Введите натуральное число n:");

    let mut sum_squares = 0;
    let mut temp = n;
    let mut digits = Vec::new();

    if n == 0 {
        sum_squares = 0;
        digits.push(0);
    } else {
        while temp > 0 {
            let digit = temp % 10;
            sum_squares += digit * digit;
            digits.push(digit);
            temp /= 10;
        }
        digits.reverse();
    }

    println!("Число: {}", n);
    println!("Цифры числа: {:?}", digits);

    // Выводим вычисления
    print!("Сумма квадратов: ");
    for (i, &digit) in digits.iter().enumerate() {
        if i > 0 {
            print!(" + ");
        }
        print!("{}²", digit);
    }
    println!(" = {}", sum_squares);

    println!("Число n: {}", n);

    if sum_squares > n {
        println!("Сумма квадратов цифр ({}) БОЛЬШЕ числа {}", sum_squares, n);
    } else if sum_squares < n {
        println!("Сумма квадратов цифр ({}) МЕНЬШЕ числа {}", sum_squares, n);
    } else {
        println!("Сумма квадратов цифр ({}) РАВНА числу {}", sum_squares, n);
    }
}

/// Задача 9: Наибольшее из 10 чисел
///
/// Дано 10 различных натуральных чисел, за которыми следует 0.
/// Определить наибольшее из них.
///
/// # Алгоритм
/// 1. Читает числа до ввода 0 или достижения 10 чисел
/// 2. Отслеживает максимальное значение
/// 3. Выводит результат и позицию максимума

pub fn task9() {
    println!("Задача 9: Наибольшее число");
    println!("Дано 10 различных натуральных чисел, за которыми следует 0.");
    println!("Определить наибольшее из них.");

    let mut numbers = Vec::new();
    let mut max_val = 0;
    let mut count = 0;

    println!("Вводите натуральные числа (0 для завершения):");

    loop {
        let num = read_u32(&format!("Число {}: ", count + 1));

        if num == 0 {
            println!("Введен 0. Завершение ввода.");
            break;
        }

        numbers.push(num);
        count += 1;

        if num > max_val {
            max_val = num;
        }

        if count >= 10 {
            println!("Введено 10 чисел. Продолжайте ввод или введите 0 для завершения.");
        }
    }

    if numbers.is_empty() {
        println!("Не введено ни одного числа!");
        return;
    }

    println!("\nВведенные числа: {:?}", numbers);
    println!("Количество введенных чисел: {}", numbers.len());
    println!("Наибольшее число: {}", max_val);
    println!(
        "Позиция наибольшего числа: {}",
        numbers.iter().position(|&x| x == max_val).unwrap() + 1
    );
}
